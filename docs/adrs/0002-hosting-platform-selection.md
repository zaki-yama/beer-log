# 2. ホスティングプラットフォームの選択

Date: 2024-03-26
Modified: 2024-03-27

## ステータス

承認

## 文脈

- RemixアプリケーションをホスティングするプラットフォームWを選定する必要がある
- 開発効率とコストのバランスを考慮する必要がある
- 将来的なスケーリングの可能性も考慮する

## 検討された選択肢

### 1. Cloudflare Pages

#### 長所
- Remixの公式アダプターが提供されており、完全にサポートされている
- エッジでの実行による高速なレスポンス
- GitHubとの優れた連携による自動デプロイ
- 無料枠が寛容（1アカウントあたり500ビルド/月、無制限の帯域幅）
- CDN、SSL証明書が標準搭載
- デプロイが簡単で開発者体験が良い
- Cloudflareの他のサービス（Workers, R2等）との統合が容易

#### 短所
- 一部の高度な機能（WebSocket等）に制限がある
- ビルド時間に制限がある（最大20分）
- カスタマイズ性は他のプラットフォームと比べて限定的
- Node.jsのバージョン選択に制限がある

### 2. Fly.io

#### 長所
- Remixの公式ドキュメントで推奨されている
- グローバルエッジデプロイメントが可能
- 無料枠が比較的generous
- DockerベースでカスタマイズしやすいI
- Node.jsアプリケーションの実行に最適化されている

#### 短所
- 料金体系がやや複雑
- AWS/GCPと比べると知見が少ない

### 3. Vercel

#### 長所
- デプロイが非常に簡単
- 優れたダッシュボード・モニタリング機能
- 大きなコミュニティと豊富な知見
- CDNが組み込まれている

#### 短所
- Next.jsに最適化されており、Remixは二級市民的な扱い
- 無料枠の制限が厳しい
- サーバーレス関数の実行時間制限が厳しい

### 4. Railway

#### 長所
- シンプルな料金体系
- GitHubとの連携が優れている
- データベースのプロビジョニングが簡単

#### 短所
- エッジデプロイメントがない
- 無料枠がない
- 比較的新しいプラットフォーム

### 5. AWS

#### 長所
- 豊富なサービスと柔軟なインフラ構成
- 高い信頼性とスケーラビリティ
- 詳細なモニタリングと運用ツール
- 大規模なコミュニティと豊富な知見
- セキュリティ機能が充実

具体的な構成案：
- ECS（Fargate）でのコンテナ実行
- Application Load Balancerによる負荷分散
- Route 53でのDNS管理
- CloudFrontによるCDN
- AWS WAFによるセキュリティ対策

#### 短所
- 初期構築のコストと手間が大きい
- 料金の見積もりが複雑
- インフラ管理の知識が必要
- 小規模アプリケーションではオーバースペック

## 決定

現時点では **Cloudflare Pages** を採用します。以下の条件下では他のプラットフォームへの移行を検討します：

1. WebSocketなど、Cloudflare Pagesでサポートされていない機能が必要になった場合
2. より高度なカスタマイズが必要になった場合
3. ビルド時間の制限が問題になった場合

理由：
1. Remixの公式サポートがあり、エッジでの実行が可能
2. デプロイが簡単で、開発者体験が優れている
3. 無料枠が寛容で、開発・検証に適している
4. CDNが標準搭載されており、グローバルでの高速なレスポンスが期待できる
5. GitHubとの連携による自動デプロイが容易

## 影響

### 良い影響
- エッジでの実行による高速なレスポンス
- デプロイの自動化が容易
- インフラ管理の負担が少ない
- コスト面での予測が容易

### 考慮すべき点
- Cloudflare Pagesの制限事項の把握が必要
- 将来的な機能要件の変更に応じて、他プラットフォームへの移行パスを確保
  - プラットフォーム固有の機能への依存を最小限に
  - 環境変数による設定の外部化
  - コンテナ化を考慮したアプリケーション設計
