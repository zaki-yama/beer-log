# 3. データベースホスティングの選択

Date: 2024-03-26

## ステータス

提案

## 文脈

- PostgreSQLデータベースのホスティングサービスを選定する必要がある
- Prisma ORMを使用する予定
- 開発の容易さとコストのバランスを考慮する必要がある

## 検討された選択肢

### 1. Supabase

#### 長所
- 無料枠が比較的寛容（500MB、10,000行まで）
- 管理画面が優れている
- データベース以外の機能も充実（認証、ストレージなど）
- リアルタイム機能が組み込まれている
- Row Level Securityのサポート

#### 短所
- ベンダーロックインの可能性
- 追加機能が多すぎて複雑になる可能性

### 2. Vercel Postgres

#### 長所
- Vercelとの統合が優れている
- シンプルな料金体系
- エッジキャッシュの機能
- 管理が容易

#### 短所
- 比較的新しいサービス
- 料金が他と比べて高め
- 機能が限定的

### 3. Neon

#### 長所
- サーバーレスアーキテクチャ
- ブランチ機能が優れている
- 自動スケーリング
- 無料枠が寛容

#### 短所
- 比較的新しいサービス
- コミュニティが小さい
- 一部の高度な機能が有料プランのみ

### 4. Amazon RDS for PostgreSQL

#### 長所
- AWSの充実したマネージドサービス
- 高い信頼性とスケーラビリティ
- 自動バックアップと復元機能
- セキュリティグループによるネットワークアクセス制御
- 監視とメトリクスが充実
- Multi-AZによる高可用性

#### 短所
- コストが比較的高い
- 初期設定が複雑
- 小規模利用では機能過剰
- インフラ管理の知識が必要

### 5. Amazon Aurora PostgreSQL

#### 長所
- RDSと比べて最大3倍のパフォーマンス
- 分散ストレージアーキテクチャによる高い信頼性
- 自動スケーリング機能の強化
- ストレージの自動拡張
- 瞬時の複製作成が可能
- グローバルデータベース機能

#### 短所
- RDSよりもさらにコストが高い
- 小〜中規模のワークロードではコスト効率が悪い
- 最小インスタンスサイズの制限
- RDSよりも複雑な運用管理

#### RDSとAuroraの主な違い
1. **アーキテクチャ**
   - RDS: 従来の単一インスタンスまたはMulti-AZ構成
   - Aurora: 分散ストレージを活用した独自アーキテクチャ

2. **パフォーマンス**
   - RDS: 標準的なPostgreSQLと同等
   - Aurora: 最大3倍の高パフォーマンス

3. **コスト**
   - RDS: 標準的な料金体系
   - Aurora: より高額だが、高負荷時のコストパフォーマンスが優れる

4. **ユースケース**
   - RDS: 小〜中規模のアプリケーション
   - Aurora: 高負荷・大規模アプリケーション、厳密なSLA要件

## 決定

現時点では **Supabase** を推奨しますが、以下の条件下ではAWSサービスへの移行を検討します：

1. アプリケーションをAWSに移行する際
   - 通常のワークロード → Amazon RDS
   - 高負荷・大規模なワークロード → Amazon Aurora
2. より高度なデータベース運用が必要になった場合
3. データベースの可用性要件が高くなった場合

理由（Supabaseを選択する現時点での理由）：
1. 無料枠が十分で、開発・検証に適している
2. 管理画面が優れており、開発効率が上がる
3. 将来的に必要になる可能性のある機能も統合されている
4. コミュニティが活発で、情報が豊富

## 影響

### 良い影響
- 開発効率の向上
- スケーラビリティの確保
- セキュリティ機能の充実
- 将来的な機能拡張の容易さ

### 考慮すべき点
- Supabaseの追加機能に依存しすぎないよう注意
- データベースの移行シナリオを検討しておく
- コスト管理の必要性
- **Amazon RDSへの移行を見据えた設計**
  - Prisma ORMを活用し、データベース固有の機能への依存を最小限に
  - マイグレーション手順の文書化
  - バックアップ・リストア手順の確立
  - 環境変数による接続情報の管理 
